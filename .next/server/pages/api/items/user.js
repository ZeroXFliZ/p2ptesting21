"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/items/user";
exports.ids = ["pages/api/items/user"];
exports.modules = {

/***/ "ethers":
/*!*************************!*\
  !*** external "ethers" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("ethers");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fitems%2Fuser&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Citems%5Cuser.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fitems%2Fuser&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Citems%5Cuser.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_items_user_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\items\\user.js */ \"(api)/./pages/api/items/user.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_items_user_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_items_user_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/items/user\",\n        pathname: \"/api/items/user\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_items_user_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRml0ZW1zJTJGdXNlciZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDaXRlbXMlNUN1c2VyLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ3lEO0FBQ3pEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxxREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMscURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3J5cHRvLXAycC1tYXJrZXRwbGFjZS8/Mjg3NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGl0ZW1zXFxcXHVzZXIuanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9pdGVtcy91c2VyXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvaXRlbXMvdXNlclwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fitems%2Fuser&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Citems%5Cuser.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/items/user.js":
/*!*********************************!*\
  !*** ./pages/api/items/user.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _utils_mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/mongodb */ \"(api)/./utils/mongodb.js\");\n/* harmony import */ var _utils_blockchain__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/blockchain */ \"(api)/./utils/blockchain.js\");\n\n\nasync function handler(req, res) {\n    if (req.method === \"GET\") {\n        try {\n            const { address } = req.query;\n            if (!address) {\n                return res.status(400).json({\n                    success: false,\n                    error: \"Wallet address is required\"\n                });\n            }\n            // Get all items from MongoDB\n            const items = await (0,_utils_mongodb__WEBPACK_IMPORTED_MODULE_0__.getAllItems)();\n            // For each item, check if it's completed on the blockchain and belongs to the user\n            const itemsWithStatus = await Promise.all(items.map(async (item)=>{\n                try {\n                    // Get trade details from blockchain\n                    const { success, details } = await (0,_utils_blockchain__WEBPACK_IMPORTED_MODULE_1__.getTradeDetails)(item.itemId);\n                    if (success) {\n                        // Check if buyer is zero address (no real buyer yet)\n                        const hasBuyer = details.buyer && details.buyer !== \"0x0000000000000000000000000000000000000000\";\n                        // Update item with blockchain data\n                        return {\n                            ...item,\n                            seller: details.seller,\n                            buyer: hasBuyer ? details.buyer : null,\n                            isDelivered: details.isDelivered,\n                            isCompleted: details.isCompleted\n                        };\n                    }\n                    return item;\n                } catch (error) {\n                    console.error(`Error getting trade details for item ${item.itemId}:`, error);\n                    return item;\n                }\n            }));\n            // Filter items by user address (either as seller or buyer) and exclude completed items\n            const userItems = itemsWithStatus.filter((item)=>{\n                // Check if user is seller or buyer\n                const isSeller = item.seller && item.seller.toLowerCase() === address.toLowerCase();\n                const isBuyer = item.buyer && item.buyer.toLowerCase() === address.toLowerCase();\n                // Include item if user is seller or buyer and item is not completed\n                return (isSeller || isBuyer) && !item.isCompleted;\n            });\n            return res.status(200).json({\n                success: true,\n                items: userItems\n            });\n        } catch (error) {\n            console.error(\"Error fetching user items:\", error);\n            return res.status(500).json({\n                success: false,\n                error: \"Failed to fetch user items\"\n            });\n        }\n    } else {\n        return res.status(405).json({\n            success: false,\n            error: \"Method not allowed\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvaXRlbXMvdXNlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBcUQ7QUFDTztBQUU3QyxlQUFlRSxRQUFRQyxHQUFHLEVBQUVDLEdBQUc7SUFDNUMsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLE9BQU87UUFDeEIsSUFBSTtZQUNGLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEdBQUdILElBQUlJLEtBQUs7WUFFN0IsSUFBSSxDQUFDRCxTQUFTO2dCQUNaLE9BQU9GLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLFNBQVM7b0JBQU9DLE9BQU87Z0JBQTZCO1lBQ3BGO1lBRUEsNkJBQTZCO1lBQzdCLE1BQU1DLFFBQVEsTUFBTVosMkRBQVdBO1lBRS9CLG1GQUFtRjtZQUNuRixNQUFNYSxrQkFBa0IsTUFBTUMsUUFBUUMsR0FBRyxDQUN2Q0gsTUFBTUksR0FBRyxDQUFDLE9BQU9DO2dCQUNmLElBQUk7b0JBQ0Ysb0NBQW9DO29CQUNwQyxNQUFNLEVBQUVQLE9BQU8sRUFBRVEsT0FBTyxFQUFFLEdBQUcsTUFBTWpCLGtFQUFlQSxDQUFDZ0IsS0FBS0UsTUFBTTtvQkFFOUQsSUFBSVQsU0FBUzt3QkFDWCxxREFBcUQ7d0JBQ3JELE1BQU1VLFdBQVdGLFFBQVFHLEtBQUssSUFBSUgsUUFBUUcsS0FBSyxLQUFLO3dCQUVwRCxtQ0FBbUM7d0JBQ25DLE9BQU87NEJBQ0wsR0FBR0osSUFBSTs0QkFDUEssUUFBUUosUUFBUUksTUFBTTs0QkFDdEJELE9BQU9ELFdBQVdGLFFBQVFHLEtBQUssR0FBRzs0QkFDbENFLGFBQWFMLFFBQVFLLFdBQVc7NEJBQ2hDQyxhQUFhTixRQUFRTSxXQUFXO3dCQUNsQztvQkFDRjtvQkFDQSxPQUFPUDtnQkFDVCxFQUFFLE9BQU9OLE9BQU87b0JBQ2RjLFFBQVFkLEtBQUssQ0FBQyxDQUFDLHFDQUFxQyxFQUFFTSxLQUFLRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUVSO29CQUN0RSxPQUFPTTtnQkFDVDtZQUNGO1lBR0YsdUZBQXVGO1lBQ3ZGLE1BQU1TLFlBQVliLGdCQUFnQmMsTUFBTSxDQUFDVixDQUFBQTtnQkFDdkMsbUNBQW1DO2dCQUNuQyxNQUFNVyxXQUFXWCxLQUFLSyxNQUFNLElBQUlMLEtBQUtLLE1BQU0sQ0FBQ08sV0FBVyxPQUFPdkIsUUFBUXVCLFdBQVc7Z0JBQ2pGLE1BQU1DLFVBQVViLEtBQUtJLEtBQUssSUFBSUosS0FBS0ksS0FBSyxDQUFDUSxXQUFXLE9BQU92QixRQUFRdUIsV0FBVztnQkFFOUUsb0VBQW9FO2dCQUNwRSxPQUFPLENBQUNELFlBQVlFLE9BQU0sS0FBTSxDQUFDYixLQUFLTyxXQUFXO1lBQ25EO1lBRUEsT0FBT3BCLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLFNBQVM7Z0JBQU1FLE9BQU9jO1lBQVU7UUFDaEUsRUFBRSxPQUFPZixPQUFPO1lBQ2RjLFFBQVFkLEtBQUssQ0FBQyw4QkFBOEJBO1lBQzVDLE9BQU9QLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLFNBQVM7Z0JBQU9DLE9BQU87WUFBNkI7UUFDcEY7SUFDRixPQUFPO1FBQ0wsT0FBT1AsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1lBQU9DLE9BQU87UUFBcUI7SUFDNUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NyeXB0by1wMnAtbWFya2V0cGxhY2UvLi9wYWdlcy9hcGkvaXRlbXMvdXNlci5qcz8wMmRiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEFsbEl0ZW1zIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbW9uZ29kYic7XG5pbXBvcnQgeyBnZXRUcmFkZURldGFpbHMgfSBmcm9tICcuLi8uLi8uLi91dGlscy9ibG9ja2NoYWluJztcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBhZGRyZXNzIH0gPSByZXEucXVlcnk7XG4gICAgICBcbiAgICAgIGlmICghYWRkcmVzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdXYWxsZXQgYWRkcmVzcyBpcyByZXF1aXJlZCcgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEdldCBhbGwgaXRlbXMgZnJvbSBNb25nb0RCXG4gICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IGdldEFsbEl0ZW1zKCk7XG4gICAgICBcbiAgICAgIC8vIEZvciBlYWNoIGl0ZW0sIGNoZWNrIGlmIGl0J3MgY29tcGxldGVkIG9uIHRoZSBibG9ja2NoYWluIGFuZCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgICBjb25zdCBpdGVtc1dpdGhTdGF0dXMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgaXRlbXMubWFwKGFzeW5jIChpdGVtKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdldCB0cmFkZSBkZXRhaWxzIGZyb20gYmxvY2tjaGFpblxuICAgICAgICAgICAgY29uc3QgeyBzdWNjZXNzLCBkZXRhaWxzIH0gPSBhd2FpdCBnZXRUcmFkZURldGFpbHMoaXRlbS5pdGVtSWQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAvLyBDaGVjayBpZiBidXllciBpcyB6ZXJvIGFkZHJlc3MgKG5vIHJlYWwgYnV5ZXIgeWV0KVxuICAgICAgICAgICAgICBjb25zdCBoYXNCdXllciA9IGRldGFpbHMuYnV5ZXIgJiYgZGV0YWlscy5idXllciAhPT0gJzB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCc7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBVcGRhdGUgaXRlbSB3aXRoIGJsb2NrY2hhaW4gZGF0YVxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLml0ZW0sXG4gICAgICAgICAgICAgICAgc2VsbGVyOiBkZXRhaWxzLnNlbGxlcixcbiAgICAgICAgICAgICAgICBidXllcjogaGFzQnV5ZXIgPyBkZXRhaWxzLmJ1eWVyIDogbnVsbCwgLy8gT25seSBzZXQgYnV5ZXIgaWYgaXQncyBub3QgemVybyBhZGRyZXNzXG4gICAgICAgICAgICAgICAgaXNEZWxpdmVyZWQ6IGRldGFpbHMuaXNEZWxpdmVyZWQsXG4gICAgICAgICAgICAgICAgaXNDb21wbGV0ZWQ6IGRldGFpbHMuaXNDb21wbGV0ZWRcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBnZXR0aW5nIHRyYWRlIGRldGFpbHMgZm9yIGl0ZW0gJHtpdGVtLml0ZW1JZH06YCwgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gRmlsdGVyIGl0ZW1zIGJ5IHVzZXIgYWRkcmVzcyAoZWl0aGVyIGFzIHNlbGxlciBvciBidXllcikgYW5kIGV4Y2x1ZGUgY29tcGxldGVkIGl0ZW1zXG4gICAgICBjb25zdCB1c2VySXRlbXMgPSBpdGVtc1dpdGhTdGF0dXMuZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIHNlbGxlciBvciBidXllclxuICAgICAgICBjb25zdCBpc1NlbGxlciA9IGl0ZW0uc2VsbGVyICYmIGl0ZW0uc2VsbGVyLnRvTG93ZXJDYXNlKCkgPT09IGFkZHJlc3MudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgaXNCdXllciA9IGl0ZW0uYnV5ZXIgJiYgaXRlbS5idXllci50b0xvd2VyQ2FzZSgpID09PSBhZGRyZXNzLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBJbmNsdWRlIGl0ZW0gaWYgdXNlciBpcyBzZWxsZXIgb3IgYnV5ZXIgYW5kIGl0ZW0gaXMgbm90IGNvbXBsZXRlZFxuICAgICAgICByZXR1cm4gKGlzU2VsbGVyIHx8IGlzQnV5ZXIpICYmICFpdGVtLmlzQ29tcGxldGVkO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGl0ZW1zOiB1c2VySXRlbXMgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHVzZXIgaXRlbXM6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHVzZXIgaXRlbXMnIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xuICB9XG59Il0sIm5hbWVzIjpbImdldEFsbEl0ZW1zIiwiZ2V0VHJhZGVEZXRhaWxzIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsImFkZHJlc3MiLCJxdWVyeSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJpdGVtcyIsIml0ZW1zV2l0aFN0YXR1cyIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJpdGVtIiwiZGV0YWlscyIsIml0ZW1JZCIsImhhc0J1eWVyIiwiYnV5ZXIiLCJzZWxsZXIiLCJpc0RlbGl2ZXJlZCIsImlzQ29tcGxldGVkIiwiY29uc29sZSIsInVzZXJJdGVtcyIsImZpbHRlciIsImlzU2VsbGVyIiwidG9Mb3dlckNhc2UiLCJpc0J1eWVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/items/user.js\n");

/***/ }),

/***/ "(api)/./utils/blockchain.js":
/*!*****************************!*\
  !*** ./utils/blockchain.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkBaseNetwork: () => (/* binding */ checkBaseNetwork),\n/* harmony export */   claimPayment: () => (/* binding */ claimPayment),\n/* harmony export */   confirmDelivery: () => (/* binding */ confirmDelivery),\n/* harmony export */   connectWallet: () => (/* binding */ connectWallet),\n/* harmony export */   editItemPrice: () => (/* binding */ editItemPrice),\n/* harmony export */   getContract: () => (/* binding */ getContract),\n/* harmony export */   getCurrentAccount: () => (/* binding */ getCurrentAccount),\n/* harmony export */   getProvider: () => (/* binding */ getProvider),\n/* harmony export */   getSigner: () => (/* binding */ getSigner),\n/* harmony export */   getTradeDetails: () => (/* binding */ getTradeDetails),\n/* harmony export */   isWalletConnected: () => (/* binding */ isWalletConnected),\n/* harmony export */   listItem: () => (/* binding */ listItem),\n/* harmony export */   purchaseItem: () => (/* binding */ purchaseItem),\n/* harmony export */   switchToBaseNetwork: () => (/* binding */ switchToBaseNetwork)\n/* harmony export */ });\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ethers */ \"ethers\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ethers__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _contracts_P2PMarketplaceABI_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../contracts/P2PMarketplaceABI.json */ \"(api)/./contracts/P2PMarketplaceABI.json\");\n\n\nconst contractAddress = \"0x101D26C5CFBcC31c6eA30b074045E4d2624649e9\";\nconst baseNetworkUrl = \"https://base.gateway.tenderly.co\";\n// Get provider based on environment\nconst getProvider = ()=>{\n    // For client-side\n    if (false) {}\n    // For server-side or fallback\n    return new ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.providers.JsonRpcProvider(baseNetworkUrl);\n};\n// Get signer for transactions\nconst getSigner = async ()=>{\n    // Check if we're on the server side\n    if (true) {\n        throw new Error(\"Cannot get signer on server-side. This function must be called from client-side code.\");\n    }\n    // Check if wallet is available\n    if (!window.ethereum) {\n        throw new Error(\"No wallet detected. Please install a Web3 wallet like MetaMask.\");\n    }\n    const provider = getProvider();\n    // Request account access if needed\n    if (provider && provider.provider && provider.provider.request) {\n        try {\n            await provider.provider.request({\n                method: \"eth_requestAccounts\"\n            });\n        } catch (error) {\n            console.error(\"Error requesting accounts:\", error);\n            throw new Error(\"Failed to connect to wallet: \" + error.message);\n        }\n    } else if (window.ethereum) {\n        // Fallback for some wallet providers\n        try {\n            await window.ethereum.request({\n                method: \"eth_requestAccounts\"\n            });\n        } catch (error) {\n            console.error(\"Error requesting accounts via window.ethereum:\", error);\n            throw new Error(\"Failed to connect to wallet: \" + error.message);\n        }\n    } else {\n        throw new Error(\"No wallet connection method available. Please make sure your wallet is unlocked.\");\n    }\n    // Verify we have accounts before returning signer\n    const accounts = await provider.listAccounts();\n    if (!accounts || accounts.length === 0) {\n        throw new Error(\"No accounts found. Please make sure your wallet is connected and unlocked.\");\n    }\n    return provider.getSigner();\n};\n// Get contract instance\nconst getContract = async (withSigner = false)=>{\n    if (!contractAddress) {\n        throw new Error(\"Contract address not configured\");\n    }\n    if (withSigner) {\n        const signer = await getSigner();\n        return new ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.Contract(contractAddress, _contracts_P2PMarketplaceABI_json__WEBPACK_IMPORTED_MODULE_1__, signer);\n    }\n    const provider = getProvider();\n    return new ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.Contract(contractAddress, _contracts_P2PMarketplaceABI_json__WEBPACK_IMPORTED_MODULE_1__, provider);\n};\n// Connect wallet and return address\nconst connectWallet = async ()=>{\n    try {\n        const signer = await getSigner();\n        const address = await signer.getAddress();\n        return {\n            success: true,\n            address\n        };\n    } catch (error) {\n        console.error(\"Error connecting wallet:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// List an item on the marketplace\nconst listItem = async (price, name, description)=>{\n    try {\n        const contract = await getContract(true);\n        const priceInWei = ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.utils.parseEther(price.toString());\n        const listingFee = ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.utils.parseEther(\"0.0000004\");\n        // Call the contract function\n        const tx = await contract.listItem(priceInWei, {\n            value: listingFee\n        });\n        // Wait for transaction to be mined\n        const receipt = await tx.wait();\n        // Get the itemId from the event\n        const event = receipt.events.find((event)=>event.event === \"ItemListed\");\n        // Check if the event exists before accessing its properties\n        if (!event || !event.args) {\n            // If event is not found, try to get the itemId from logs\n            console.log(\"ItemListed event not found in transaction receipt, trying alternative methods\");\n            // Since we can't directly access nextItemId (it's private in the contract),\n            // we'll need to estimate it based on transaction data or use another approach\n            // Let's try to query the transaction receipt for more information\n            const logs = receipt.logs;\n            let itemId;\n            // Try to extract itemId from logs\n            if (logs && logs.length > 0) {\n                // Look for the last log which might contain our event data\n                const lastLog = logs[logs.length - 1];\n                // Try to decode the log data to find the itemId\n                try {\n                    // The itemId is likely in the data or topics of the log\n                    // This is a simplified approach - might need adjustment based on actual log structure\n                    const topicData = lastLog.topics[1]; // Second topic often contains indexed parameters\n                    if (topicData) {\n                        itemId = parseInt(topicData, 16);\n                    }\n                } catch (err) {\n                    console.error(\"Error extracting itemId from logs:\", err);\n                }\n            }\n            // If we couldn't extract from logs, make a best guess\n            if (!itemId) {\n                // As a fallback, we'll query a recent item to estimate the ID\n                // This is not ideal but better than failing completely\n                itemId = Date.now(); // Use timestamp as a last resort placeholder\n                console.warn(\"Could not determine exact itemId, using fallback method\");\n            }\n            return {\n                success: true,\n                itemId\n            };\n        }\n        const itemId = event.args.itemId.toNumber();\n        return {\n            success: true,\n            itemId\n        };\n    } catch (error) {\n        console.error(\"Error listing item:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// Purchase an item\nconst purchaseItem = async (itemId, price)=>{\n    try {\n        const contract = await getContract(true);\n        const priceInWei = ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.utils.parseEther(price.toString());\n        // Call the contract function\n        const tx = await contract.purchaseItem(itemId, {\n            value: priceInWei\n        });\n        // Wait for transaction to be mined\n        await tx.wait();\n        return {\n            success: true\n        };\n    } catch (error) {\n        console.error(\"Error purchasing item:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// Confirm delivery of an item\nconst confirmDelivery = async (itemId)=>{\n    try {\n        const contract = await getContract(true);\n        // Call the contract function\n        const tx = await contract.confirmDelivery(itemId);\n        // Wait for transaction to be mined\n        await tx.wait();\n        return {\n            success: true\n        };\n    } catch (error) {\n        console.error(\"Error confirming delivery:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// Claim payment for a sold item\nconst claimPayment = async (itemId)=>{\n    try {\n        const contract = await getContract(true);\n        // Call the contract function\n        const tx = await contract.claimPayment(itemId);\n        // Wait for transaction to be mined\n        await tx.wait();\n        return {\n            success: true\n        };\n    } catch (error) {\n        console.error(\"Error claiming payment:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// Edit item price\nconst editItemPrice = async (itemId, newPrice)=>{\n    try {\n        const contract = await getContract(true);\n        const priceInWei = ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.utils.parseEther(newPrice.toString());\n        // Call the contract function\n        const tx = await contract.editItemPrice(itemId, priceInWei);\n        // Wait for transaction to be mined\n        await tx.wait();\n        return {\n            success: true\n        };\n    } catch (error) {\n        console.error(\"Error editing item price:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// Get trade details\nconst getTradeDetails = async (itemId)=>{\n    try {\n        const contract = await getContract();\n        // Call the contract function\n        const details = await contract.getTradeDetails(itemId);\n        return {\n            success: true,\n            details: {\n                seller: details[0],\n                buyer: details[1],\n                price: ethers__WEBPACK_IMPORTED_MODULE_0__.ethers.utils.formatEther(details[2]),\n                isDelivered: details[3],\n                isCompleted: details[4]\n            }\n        };\n    } catch (error) {\n        console.error(\"Error getting trade details:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n// Check if wallet is connected\nconst isWalletConnected = async ()=>{\n    try {\n        if (true) {\n            return false;\n        }\n        const provider = getProvider();\n        const accounts = await provider.listAccounts();\n        return accounts && accounts.length > 0;\n    } catch (error) {\n        console.error(\"Error checking wallet connection:\", error);\n        return false;\n    }\n};\n// Get current account\nconst getCurrentAccount = async ()=>{\n    try {\n        if (!await isWalletConnected()) {\n            return null;\n        }\n        const provider = getProvider();\n        const accounts = await provider.listAccounts();\n        return accounts[0] || null;\n    } catch (error) {\n        console.error(\"Error getting current account:\", error);\n        return null;\n    }\n};\n// Check if user is connected to Base blockchain\nconst checkBaseNetwork = async ()=>{\n    try {\n        if (true) {\n            return {\n                isBase: false,\n                chainId: null\n            };\n        }\n        const provider = getProvider();\n        const network = await provider.getNetwork();\n        // Base Mainnet chainId is 8453, Base Testnet (Goerli) is 84531\n        // We'll check for both to support development environments\n        const baseChainIds = [\n            8453,\n            84531\n        ];\n        const isBase = baseChainIds.includes(network.chainId);\n        return {\n            isBase,\n            chainId: network.chainId,\n            name: network.name\n        };\n    } catch (error) {\n        console.error(\"Error checking network:\", error);\n        return {\n            isBase: false,\n            chainId: null\n        };\n    }\n};\n// Switch to Base network\nconst switchToBaseNetwork = async ()=>{\n    try {\n        if (true) {\n            return {\n                success: false,\n                error: \"No wallet detected\"\n            };\n        }\n        // Base Mainnet parameters\n        const baseChainId = \"0x2105\"; // 8453 in hex\n        const baseParams = {\n            chainId: baseChainId,\n            chainName: \"Base Mainnet\",\n            nativeCurrency: {\n                name: \"Ethereum\",\n                symbol: \"ETH\",\n                decimals: 18\n            },\n            rpcUrls: [\n                \"https://base.gateway.tenderly.co\"\n            ],\n            blockExplorerUrls: [\n                \"https://basescan.org\"\n            ]\n        };\n        try {\n            // First try to switch to the network\n            await window.ethereum.request({\n                method: \"wallet_switchEthereumChain\",\n                params: [\n                    {\n                        chainId: baseChainId\n                    }\n                ]\n            });\n            return {\n                success: true\n            };\n        } catch (switchError) {\n            // If the network is not added to MetaMask, add it\n            if (switchError.code === 4902) {\n                try {\n                    await window.ethereum.request({\n                        method: \"wallet_addEthereumChain\",\n                        params: [\n                            baseParams\n                        ]\n                    });\n                    return {\n                        success: true\n                    };\n                } catch (addError) {\n                    return {\n                        success: false,\n                        error: \"Failed to add Base network: \" + addError.message\n                    };\n                }\n            } else {\n                return {\n                    success: false,\n                    error: \"Failed to switch to Base network: \" + switchError.message\n                };\n            }\n        }\n    } catch (error) {\n        console.error(\"Error switching network:\", error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlBLFlBQVlDLElBQUksS0FBSyxNQUFNO2dCQUM3QixJQUFJO29CQUNGLE1BQU10RixPQUFPQyxRQUFRLENBQUNPLE9BQU8sQ0FBQzt3QkFDNUJDLFFBQVE7d0JBQ1IyRSxRQUFROzRCQUFDUDt5QkFBVztvQkFDdEI7b0JBQ0EsT0FBTzt3QkFBRXRELFNBQVM7b0JBQUs7Z0JBQ3pCLEVBQUUsT0FBT2dFLFVBQVU7b0JBQ2pCLE9BQU87d0JBQUVoRSxTQUFTO3dCQUFPYixPQUFPLGlDQUFpQzZFLFNBQVMzRSxPQUFPO29CQUFDO2dCQUNwRjtZQUNGLE9BQU87Z0JBQ0wsT0FBTztvQkFBRVcsU0FBUztvQkFBT2IsT0FBTyx1Q0FBdUMyRSxZQUFZekUsT0FBTztnQkFBQztZQUM3RjtRQUNGO0lBQ0YsRUFBRSxPQUFPRixPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyw0QkFBNEJBO1FBQzFDLE9BQU87WUFBRWEsU0FBUztZQUFPYixPQUFPQSxNQUFNRSxPQUFPO1FBQUM7SUFDaEQ7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3J5cHRvLXAycC1tYXJrZXRwbGFjZS8uL3V0aWxzL2Jsb2NrY2hhaW4uanM/YzlkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBldGhlcnMgfSBmcm9tICdldGhlcnMnO1xuaW1wb3J0IFAyUE1hcmtldHBsYWNlQUJJIGZyb20gJy4uL2NvbnRyYWN0cy9QMlBNYXJrZXRwbGFjZUFCSS5qc29uJztcblxuY29uc3QgY29udHJhY3RBZGRyZXNzID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQ09OVFJBQ1RfQUREUkVTUztcbmNvbnN0IGJhc2VOZXR3b3JrVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQkFTRV9ORVRXT1JLX1VSTDtcblxuLy8gR2V0IHByb3ZpZGVyIGJhc2VkIG9uIGVudmlyb25tZW50XG5leHBvcnQgY29uc3QgZ2V0UHJvdmlkZXIgPSAoKSA9PiB7XG4gIC8vIEZvciBjbGllbnQtc2lkZVxuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmV0aGVyZXVtKSB7XG4gICAgcmV0dXJuIG5ldyBldGhlcnMucHJvdmlkZXJzLldlYjNQcm92aWRlcih3aW5kb3cuZXRoZXJldW0pO1xuICB9XG4gIFxuICAvLyBGb3Igc2VydmVyLXNpZGUgb3IgZmFsbGJhY2tcbiAgcmV0dXJuIG5ldyBldGhlcnMucHJvdmlkZXJzLkpzb25ScGNQcm92aWRlcihiYXNlTmV0d29ya1VybCk7XG59O1xuXG4vLyBHZXQgc2lnbmVyIGZvciB0cmFuc2FjdGlvbnNcbmV4cG9ydCBjb25zdCBnZXRTaWduZXIgPSBhc3luYyAoKSA9PiB7XG4gIC8vIENoZWNrIGlmIHdlJ3JlIG9uIHRoZSBzZXJ2ZXIgc2lkZVxuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBnZXQgc2lnbmVyIG9uIHNlcnZlci1zaWRlLiBUaGlzIGZ1bmN0aW9uIG11c3QgYmUgY2FsbGVkIGZyb20gY2xpZW50LXNpZGUgY29kZS4nKTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgaWYgd2FsbGV0IGlzIGF2YWlsYWJsZVxuICBpZiAoIXdpbmRvdy5ldGhlcmV1bSkge1xuICAgIHRocm93IG5ldyBFcnJvcignTm8gd2FsbGV0IGRldGVjdGVkLiBQbGVhc2UgaW5zdGFsbCBhIFdlYjMgd2FsbGV0IGxpa2UgTWV0YU1hc2suJyk7XG4gIH1cbiAgXG4gIGNvbnN0IHByb3ZpZGVyID0gZ2V0UHJvdmlkZXIoKTtcbiAgXG4gIC8vIFJlcXVlc3QgYWNjb3VudCBhY2Nlc3MgaWYgbmVlZGVkXG4gIGlmIChwcm92aWRlciAmJiBwcm92aWRlci5wcm92aWRlciAmJiBwcm92aWRlci5wcm92aWRlci5yZXF1ZXN0KSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHByb3ZpZGVyLnByb3ZpZGVyLnJlcXVlc3QoeyBtZXRob2Q6ICdldGhfcmVxdWVzdEFjY291bnRzJyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVxdWVzdGluZyBhY2NvdW50czonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIHdhbGxldDogJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfSBlbHNlIGlmICh3aW5kb3cuZXRoZXJldW0pIHtcbiAgICAvLyBGYWxsYmFjayBmb3Igc29tZSB3YWxsZXQgcHJvdmlkZXJzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdpbmRvdy5ldGhlcmV1bS5yZXF1ZXN0KHsgbWV0aG9kOiAnZXRoX3JlcXVlc3RBY2NvdW50cycgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlcXVlc3RpbmcgYWNjb3VudHMgdmlhIHdpbmRvdy5ldGhlcmV1bTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIHdhbGxldDogJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHdhbGxldCBjb25uZWN0aW9uIG1ldGhvZCBhdmFpbGFibGUuIFBsZWFzZSBtYWtlIHN1cmUgeW91ciB3YWxsZXQgaXMgdW5sb2NrZWQuJyk7XG4gIH1cbiAgXG4gIC8vIFZlcmlmeSB3ZSBoYXZlIGFjY291bnRzIGJlZm9yZSByZXR1cm5pbmcgc2lnbmVyXG4gIGNvbnN0IGFjY291bnRzID0gYXdhaXQgcHJvdmlkZXIubGlzdEFjY291bnRzKCk7XG4gIGlmICghYWNjb3VudHMgfHwgYWNjb3VudHMubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyBhY2NvdW50cyBmb3VuZC4gUGxlYXNlIG1ha2Ugc3VyZSB5b3VyIHdhbGxldCBpcyBjb25uZWN0ZWQgYW5kIHVubG9ja2VkLicpO1xuICB9XG4gIFxuICByZXR1cm4gcHJvdmlkZXIuZ2V0U2lnbmVyKCk7XG59O1xuXG4vLyBHZXQgY29udHJhY3QgaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBnZXRDb250cmFjdCA9IGFzeW5jICh3aXRoU2lnbmVyID0gZmFsc2UpID0+IHtcbiAgaWYgKCFjb250cmFjdEFkZHJlc3MpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRyYWN0IGFkZHJlc3Mgbm90IGNvbmZpZ3VyZWQnKTtcbiAgfVxuICBcbiAgaWYgKHdpdGhTaWduZXIpIHtcbiAgICBjb25zdCBzaWduZXIgPSBhd2FpdCBnZXRTaWduZXIoKTtcbiAgICByZXR1cm4gbmV3IGV0aGVycy5Db250cmFjdChjb250cmFjdEFkZHJlc3MsIFAyUE1hcmtldHBsYWNlQUJJLCBzaWduZXIpO1xuICB9XG4gIFxuICBjb25zdCBwcm92aWRlciA9IGdldFByb3ZpZGVyKCk7XG4gIHJldHVybiBuZXcgZXRoZXJzLkNvbnRyYWN0KGNvbnRyYWN0QWRkcmVzcywgUDJQTWFya2V0cGxhY2VBQkksIHByb3ZpZGVyKTtcbn07XG5cbi8vIENvbm5lY3Qgd2FsbGV0IGFuZCByZXR1cm4gYWRkcmVzc1xuZXhwb3J0IGNvbnN0IGNvbm5lY3RXYWxsZXQgPSBhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2lnbmVyID0gYXdhaXQgZ2V0U2lnbmVyKCk7XG4gICAgY29uc3QgYWRkcmVzcyA9IGF3YWl0IHNpZ25lci5nZXRBZGRyZXNzKCk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWRkcmVzcyB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbm5lY3Rpbmcgd2FsbGV0OicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgfVxufTtcblxuLy8gTGlzdCBhbiBpdGVtIG9uIHRoZSBtYXJrZXRwbGFjZVxuZXhwb3J0IGNvbnN0IGxpc3RJdGVtID0gYXN5bmMgKHByaWNlLCBuYW1lLCBkZXNjcmlwdGlvbikgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgZ2V0Q29udHJhY3QodHJ1ZSk7XG4gICAgY29uc3QgcHJpY2VJbldlaSA9IGV0aGVycy51dGlscy5wYXJzZUV0aGVyKHByaWNlLnRvU3RyaW5nKCkpO1xuICAgIGNvbnN0IGxpc3RpbmdGZWUgPSBldGhlcnMudXRpbHMucGFyc2VFdGhlcignMC4wMDAwMDA0Jyk7XG4gICAgXG4gICAgLy8gQ2FsbCB0aGUgY29udHJhY3QgZnVuY3Rpb25cbiAgICBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0Lmxpc3RJdGVtKHByaWNlSW5XZWksIHtcbiAgICAgIHZhbHVlOiBsaXN0aW5nRmVlXG4gICAgfSk7XG4gICAgXG4gICAgLy8gV2FpdCBmb3IgdHJhbnNhY3Rpb24gdG8gYmUgbWluZWRcbiAgICBjb25zdCByZWNlaXB0ID0gYXdhaXQgdHgud2FpdCgpO1xuICAgIFxuICAgIC8vIEdldCB0aGUgaXRlbUlkIGZyb20gdGhlIGV2ZW50XG4gICAgY29uc3QgZXZlbnQgPSByZWNlaXB0LmV2ZW50cy5maW5kKGV2ZW50ID0+IGV2ZW50LmV2ZW50ID09PSAnSXRlbUxpc3RlZCcpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHRoZSBldmVudCBleGlzdHMgYmVmb3JlIGFjY2Vzc2luZyBpdHMgcHJvcGVydGllc1xuICAgIGlmICghZXZlbnQgfHwgIWV2ZW50LmFyZ3MpIHtcbiAgICAgIC8vIElmIGV2ZW50IGlzIG5vdCBmb3VuZCwgdHJ5IHRvIGdldCB0aGUgaXRlbUlkIGZyb20gbG9nc1xuICAgICAgY29uc29sZS5sb2coJ0l0ZW1MaXN0ZWQgZXZlbnQgbm90IGZvdW5kIGluIHRyYW5zYWN0aW9uIHJlY2VpcHQsIHRyeWluZyBhbHRlcm5hdGl2ZSBtZXRob2RzJyk7XG4gICAgICBcbiAgICAgIC8vIFNpbmNlIHdlIGNhbid0IGRpcmVjdGx5IGFjY2VzcyBuZXh0SXRlbUlkIChpdCdzIHByaXZhdGUgaW4gdGhlIGNvbnRyYWN0KSxcbiAgICAgIC8vIHdlJ2xsIG5lZWQgdG8gZXN0aW1hdGUgaXQgYmFzZWQgb24gdHJhbnNhY3Rpb24gZGF0YSBvciB1c2UgYW5vdGhlciBhcHByb2FjaFxuICAgICAgLy8gTGV0J3MgdHJ5IHRvIHF1ZXJ5IHRoZSB0cmFuc2FjdGlvbiByZWNlaXB0IGZvciBtb3JlIGluZm9ybWF0aW9uXG4gICAgICBjb25zdCBsb2dzID0gcmVjZWlwdC5sb2dzO1xuICAgICAgbGV0IGl0ZW1JZDtcbiAgICAgIFxuICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgaXRlbUlkIGZyb20gbG9nc1xuICAgICAgaWYgKGxvZ3MgJiYgbG9ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIExvb2sgZm9yIHRoZSBsYXN0IGxvZyB3aGljaCBtaWdodCBjb250YWluIG91ciBldmVudCBkYXRhXG4gICAgICAgIGNvbnN0IGxhc3RMb2cgPSBsb2dzW2xvZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIC8vIFRyeSB0byBkZWNvZGUgdGhlIGxvZyBkYXRhIHRvIGZpbmQgdGhlIGl0ZW1JZFxuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFRoZSBpdGVtSWQgaXMgbGlrZWx5IGluIHRoZSBkYXRhIG9yIHRvcGljcyBvZiB0aGUgbG9nXG4gICAgICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsaWZpZWQgYXBwcm9hY2ggLSBtaWdodCBuZWVkIGFkanVzdG1lbnQgYmFzZWQgb24gYWN0dWFsIGxvZyBzdHJ1Y3R1cmVcbiAgICAgICAgICBjb25zdCB0b3BpY0RhdGEgPSBsYXN0TG9nLnRvcGljc1sxXTsgLy8gU2Vjb25kIHRvcGljIG9mdGVuIGNvbnRhaW5zIGluZGV4ZWQgcGFyYW1ldGVyc1xuICAgICAgICAgIGlmICh0b3BpY0RhdGEpIHtcbiAgICAgICAgICAgIGl0ZW1JZCA9IHBhcnNlSW50KHRvcGljRGF0YSwgMTYpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXh0cmFjdGluZyBpdGVtSWQgZnJvbSBsb2dzOicsIGVycik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSWYgd2UgY291bGRuJ3QgZXh0cmFjdCBmcm9tIGxvZ3MsIG1ha2UgYSBiZXN0IGd1ZXNzXG4gICAgICBpZiAoIWl0ZW1JZCkge1xuICAgICAgICAvLyBBcyBhIGZhbGxiYWNrLCB3ZSdsbCBxdWVyeSBhIHJlY2VudCBpdGVtIHRvIGVzdGltYXRlIHRoZSBJRFxuICAgICAgICAvLyBUaGlzIGlzIG5vdCBpZGVhbCBidXQgYmV0dGVyIHRoYW4gZmFpbGluZyBjb21wbGV0ZWx5XG4gICAgICAgIGl0ZW1JZCA9IERhdGUubm93KCk7IC8vIFVzZSB0aW1lc3RhbXAgYXMgYSBsYXN0IHJlc29ydCBwbGFjZWhvbGRlclxuICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBkZXRlcm1pbmUgZXhhY3QgaXRlbUlkLCB1c2luZyBmYWxsYmFjayBtZXRob2QnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaXRlbUlkIH07XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGl0ZW1JZCA9IGV2ZW50LmFyZ3MuaXRlbUlkLnRvTnVtYmVyKCk7XG4gICAgXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgaXRlbUlkIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbGlzdGluZyBpdGVtOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgfVxufTtcblxuLy8gUHVyY2hhc2UgYW4gaXRlbVxuZXhwb3J0IGNvbnN0IHB1cmNoYXNlSXRlbSA9IGFzeW5jIChpdGVtSWQsIHByaWNlKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCBnZXRDb250cmFjdCh0cnVlKTtcbiAgICBjb25zdCBwcmljZUluV2VpID0gZXRoZXJzLnV0aWxzLnBhcnNlRXRoZXIocHJpY2UudG9TdHJpbmcoKSk7XG4gICAgXG4gICAgLy8gQ2FsbCB0aGUgY29udHJhY3QgZnVuY3Rpb25cbiAgICBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LnB1cmNoYXNlSXRlbShpdGVtSWQsIHtcbiAgICAgIHZhbHVlOiBwcmljZUluV2VpXG4gICAgfSk7XG4gICAgXG4gICAgLy8gV2FpdCBmb3IgdHJhbnNhY3Rpb24gdG8gYmUgbWluZWRcbiAgICBhd2FpdCB0eC53YWl0KCk7XG4gICAgXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHB1cmNoYXNpbmcgaXRlbTonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gIH1cbn07XG5cbi8vIENvbmZpcm0gZGVsaXZlcnkgb2YgYW4gaXRlbVxuZXhwb3J0IGNvbnN0IGNvbmZpcm1EZWxpdmVyeSA9IGFzeW5jIChpdGVtSWQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb250cmFjdCA9IGF3YWl0IGdldENvbnRyYWN0KHRydWUpO1xuICAgIFxuICAgIC8vIENhbGwgdGhlIGNvbnRyYWN0IGZ1bmN0aW9uXG4gICAgY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5jb25maXJtRGVsaXZlcnkoaXRlbUlkKTtcbiAgICBcbiAgICAvLyBXYWl0IGZvciB0cmFuc2FjdGlvbiB0byBiZSBtaW5lZFxuICAgIGF3YWl0IHR4LndhaXQoKTtcbiAgICBcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY29uZmlybWluZyBkZWxpdmVyeTonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gIH1cbn07XG5cbi8vIENsYWltIHBheW1lbnQgZm9yIGEgc29sZCBpdGVtXG5leHBvcnQgY29uc3QgY2xhaW1QYXltZW50ID0gYXN5bmMgKGl0ZW1JZCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgZ2V0Q29udHJhY3QodHJ1ZSk7XG4gICAgXG4gICAgLy8gQ2FsbCB0aGUgY29udHJhY3QgZnVuY3Rpb25cbiAgICBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmNsYWltUGF5bWVudChpdGVtSWQpO1xuICAgIFxuICAgIC8vIFdhaXQgZm9yIHRyYW5zYWN0aW9uIHRvIGJlIG1pbmVkXG4gICAgYXdhaXQgdHgud2FpdCgpO1xuICAgIFxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGFpbWluZyBwYXltZW50OicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgfVxufTtcblxuLy8gRWRpdCBpdGVtIHByaWNlXG5leHBvcnQgY29uc3QgZWRpdEl0ZW1QcmljZSA9IGFzeW5jIChpdGVtSWQsIG5ld1ByaWNlKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCBnZXRDb250cmFjdCh0cnVlKTtcbiAgICBjb25zdCBwcmljZUluV2VpID0gZXRoZXJzLnV0aWxzLnBhcnNlRXRoZXIobmV3UHJpY2UudG9TdHJpbmcoKSk7XG4gICAgXG4gICAgLy8gQ2FsbCB0aGUgY29udHJhY3QgZnVuY3Rpb25cbiAgICBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmVkaXRJdGVtUHJpY2UoaXRlbUlkLCBwcmljZUluV2VpKTtcbiAgICBcbiAgICAvLyBXYWl0IGZvciB0cmFuc2FjdGlvbiB0byBiZSBtaW5lZFxuICAgIGF3YWl0IHR4LndhaXQoKTtcbiAgICBcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZWRpdGluZyBpdGVtIHByaWNlOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgfVxufTtcblxuLy8gR2V0IHRyYWRlIGRldGFpbHNcbmV4cG9ydCBjb25zdCBnZXRUcmFkZURldGFpbHMgPSBhc3luYyAoaXRlbUlkKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udHJhY3QgPSBhd2FpdCBnZXRDb250cmFjdCgpO1xuICAgIFxuICAgIC8vIENhbGwgdGhlIGNvbnRyYWN0IGZ1bmN0aW9uXG4gICAgY29uc3QgZGV0YWlscyA9IGF3YWl0IGNvbnRyYWN0LmdldFRyYWRlRGV0YWlscyhpdGVtSWQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGV0YWlsczoge1xuICAgICAgICBzZWxsZXI6IGRldGFpbHNbMF0sXG4gICAgICAgIGJ1eWVyOiBkZXRhaWxzWzFdLFxuICAgICAgICBwcmljZTogZXRoZXJzLnV0aWxzLmZvcm1hdEV0aGVyKGRldGFpbHNbMl0pLFxuICAgICAgICBpc0RlbGl2ZXJlZDogZGV0YWlsc1szXSxcbiAgICAgICAgaXNDb21wbGV0ZWQ6IGRldGFpbHNbNF1cbiAgICAgIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdHJhZGUgZGV0YWlsczonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gIH1cbn07XG5cbi8vIENoZWNrIGlmIHdhbGxldCBpcyBjb25uZWN0ZWRcbmV4cG9ydCBjb25zdCBpc1dhbGxldENvbm5lY3RlZCA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgIXdpbmRvdy5ldGhlcmV1bSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBwcm92aWRlciA9IGdldFByb3ZpZGVyKCk7XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBwcm92aWRlci5saXN0QWNjb3VudHMoKTtcbiAgICByZXR1cm4gYWNjb3VudHMgJiYgYWNjb3VudHMubGVuZ3RoID4gMDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyB3YWxsZXQgY29ubmVjdGlvbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vLyBHZXQgY3VycmVudCBhY2NvdW50XG5leHBvcnQgY29uc3QgZ2V0Q3VycmVudEFjY291bnQgPSBhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKCFhd2FpdCBpc1dhbGxldENvbm5lY3RlZCgpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcHJvdmlkZXIgPSBnZXRQcm92aWRlcigpO1xuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgcHJvdmlkZXIubGlzdEFjY291bnRzKCk7XG4gICAgcmV0dXJuIGFjY291bnRzWzBdIHx8IG51bGw7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBjdXJyZW50IGFjY291bnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG4vLyBDaGVjayBpZiB1c2VyIGlzIGNvbm5lY3RlZCB0byBCYXNlIGJsb2NrY2hhaW5cbmV4cG9ydCBjb25zdCBjaGVja0Jhc2VOZXR3b3JrID0gYXN5bmMgKCkgPT4ge1xuICB0cnkge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyB8fCAhd2luZG93LmV0aGVyZXVtKSB7XG4gICAgICByZXR1cm4geyBpc0Jhc2U6IGZhbHNlLCBjaGFpbklkOiBudWxsIH07XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHByb3ZpZGVyID0gZ2V0UHJvdmlkZXIoKTtcbiAgICBjb25zdCBuZXR3b3JrID0gYXdhaXQgcHJvdmlkZXIuZ2V0TmV0d29yaygpO1xuICAgIFxuICAgIC8vIEJhc2UgTWFpbm5ldCBjaGFpbklkIGlzIDg0NTMsIEJhc2UgVGVzdG5ldCAoR29lcmxpKSBpcyA4NDUzMVxuICAgIC8vIFdlJ2xsIGNoZWNrIGZvciBib3RoIHRvIHN1cHBvcnQgZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnRzXG4gICAgY29uc3QgYmFzZUNoYWluSWRzID0gWzg0NTMsIDg0NTMxXTtcbiAgICBjb25zdCBpc0Jhc2UgPSBiYXNlQ2hhaW5JZHMuaW5jbHVkZXMobmV0d29yay5jaGFpbklkKTtcbiAgICBcbiAgICByZXR1cm4geyBcbiAgICAgIGlzQmFzZSwgXG4gICAgICBjaGFpbklkOiBuZXR3b3JrLmNoYWluSWQsXG4gICAgICBuYW1lOiBuZXR3b3JrLm5hbWVcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIG5ldHdvcms6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IGlzQmFzZTogZmFsc2UsIGNoYWluSWQ6IG51bGwgfTtcbiAgfVxufTtcblxuLy8gU3dpdGNoIHRvIEJhc2UgbmV0d29ya1xuZXhwb3J0IGNvbnN0IHN3aXRjaFRvQmFzZU5ldHdvcmsgPSBhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnIHx8ICF3aW5kb3cuZXRoZXJldW0pIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIHdhbGxldCBkZXRlY3RlZCcgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gQmFzZSBNYWlubmV0IHBhcmFtZXRlcnNcbiAgICBjb25zdCBiYXNlQ2hhaW5JZCA9ICcweDIxMDUnOyAvLyA4NDUzIGluIGhleFxuICAgIGNvbnN0IGJhc2VQYXJhbXMgPSB7XG4gICAgICBjaGFpbklkOiBiYXNlQ2hhaW5JZCxcbiAgICAgIGNoYWluTmFtZTogJ0Jhc2UgTWFpbm5ldCcsXG4gICAgICBuYXRpdmVDdXJyZW5jeToge1xuICAgICAgICBuYW1lOiAnRXRoZXJldW0nLFxuICAgICAgICBzeW1ib2w6ICdFVEgnLFxuICAgICAgICBkZWNpbWFsczogMThcbiAgICAgIH0sXG4gICAgICBycGNVcmxzOiBbJ2h0dHBzOi8vYmFzZS5nYXRld2F5LnRlbmRlcmx5LmNvJ10sXG4gICAgICBibG9ja0V4cGxvcmVyVXJsczogWydodHRwczovL2Jhc2VzY2FuLm9yZyddXG4gICAgfTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QgdHJ5IHRvIHN3aXRjaCB0byB0aGUgbmV0d29ya1xuICAgICAgYXdhaXQgd2luZG93LmV0aGVyZXVtLnJlcXVlc3Qoe1xuICAgICAgICBtZXRob2Q6ICd3YWxsZXRfc3dpdGNoRXRoZXJldW1DaGFpbicsXG4gICAgICAgIHBhcmFtczogW3sgY2hhaW5JZDogYmFzZUNoYWluSWQgfV1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKHN3aXRjaEVycm9yKSB7XG4gICAgICAvLyBJZiB0aGUgbmV0d29yayBpcyBub3QgYWRkZWQgdG8gTWV0YU1hc2ssIGFkZCBpdFxuICAgICAgaWYgKHN3aXRjaEVycm9yLmNvZGUgPT09IDQ5MDIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB3aW5kb3cuZXRoZXJldW0ucmVxdWVzdCh7XG4gICAgICAgICAgICBtZXRob2Q6ICd3YWxsZXRfYWRkRXRoZXJldW1DaGFpbicsXG4gICAgICAgICAgICBwYXJhbXM6IFtiYXNlUGFyYW1zXVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICAgICAgfSBjYXRjaCAoYWRkRXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gYWRkIEJhc2UgbmV0d29yazogJyArIGFkZEVycm9yLm1lc3NhZ2UgfTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHN3aXRjaCB0byBCYXNlIG5ldHdvcms6ICcgKyBzd2l0Y2hFcnJvci5tZXNzYWdlIH07XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN3aXRjaGluZyBuZXR3b3JrOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgfVxufTsiXSwibmFtZXMiOlsiZXRoZXJzIiwiUDJQTWFya2V0cGxhY2VBQkkiLCJjb250cmFjdEFkZHJlc3MiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfQ09OVFJBQ1RfQUREUkVTUyIsImJhc2VOZXR3b3JrVXJsIiwiTkVYVF9QVUJMSUNfQkFTRV9ORVRXT1JLX1VSTCIsImdldFByb3ZpZGVyIiwid2luZG93IiwiZXRoZXJldW0iLCJwcm92aWRlcnMiLCJXZWIzUHJvdmlkZXIiLCJKc29uUnBjUHJvdmlkZXIiLCJnZXRTaWduZXIiLCJFcnJvciIsInByb3ZpZGVyIiwicmVxdWVzdCIsIm1ldGhvZCIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJhY2NvdW50cyIsImxpc3RBY2NvdW50cyIsImxlbmd0aCIsImdldENvbnRyYWN0Iiwid2l0aFNpZ25lciIsInNpZ25lciIsIkNvbnRyYWN0IiwiY29ubmVjdFdhbGxldCIsImFkZHJlc3MiLCJnZXRBZGRyZXNzIiwic3VjY2VzcyIsImxpc3RJdGVtIiwicHJpY2UiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJjb250cmFjdCIsInByaWNlSW5XZWkiLCJ1dGlscyIsInBhcnNlRXRoZXIiLCJ0b1N0cmluZyIsImxpc3RpbmdGZWUiLCJ0eCIsInZhbHVlIiwicmVjZWlwdCIsIndhaXQiLCJldmVudCIsImV2ZW50cyIsImZpbmQiLCJhcmdzIiwibG9nIiwibG9ncyIsIml0ZW1JZCIsImxhc3RMb2ciLCJ0b3BpY0RhdGEiLCJ0b3BpY3MiLCJwYXJzZUludCIsImVyciIsIkRhdGUiLCJub3ciLCJ3YXJuIiwidG9OdW1iZXIiLCJwdXJjaGFzZUl0ZW0iLCJjb25maXJtRGVsaXZlcnkiLCJjbGFpbVBheW1lbnQiLCJlZGl0SXRlbVByaWNlIiwibmV3UHJpY2UiLCJnZXRUcmFkZURldGFpbHMiLCJkZXRhaWxzIiwic2VsbGVyIiwiYnV5ZXIiLCJmb3JtYXRFdGhlciIsImlzRGVsaXZlcmVkIiwiaXNDb21wbGV0ZWQiLCJpc1dhbGxldENvbm5lY3RlZCIsImdldEN1cnJlbnRBY2NvdW50IiwiY2hlY2tCYXNlTmV0d29yayIsImlzQmFzZSIsImNoYWluSWQiLCJuZXR3b3JrIiwiZ2V0TmV0d29yayIsImJhc2VDaGFpbklkcyIsImluY2x1ZGVzIiwic3dpdGNoVG9CYXNlTmV0d29yayIsImJhc2VDaGFpbklkIiwiYmFzZVBhcmFtcyIsImNoYWluTmFtZSIsIm5hdGl2ZUN1cnJlbmN5Iiwic3ltYm9sIiwiZGVjaW1hbHMiLCJycGNVcmxzIiwiYmxvY2tFeHBsb3JlclVybHMiLCJwYXJhbXMiLCJzd2l0Y2hFcnJvciIsImNvZGUiLCJhZGRFcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./utils/blockchain.js\n");

/***/ }),

/***/ "(api)/./utils/mongodb.js":
/*!**************************!*\
  !*** ./utils/mongodb.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createItem: () => (/* binding */ createItem),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   deleteItem: () => (/* binding */ deleteItem),\n/* harmony export */   getAllItems: () => (/* binding */ getAllItems),\n/* harmony export */   getItemById: () => (/* binding */ getItemById),\n/* harmony export */   getItemsCollection: () => (/* binding */ getItemsCollection),\n/* harmony export */   searchItems: () => (/* binding */ searchItems),\n/* harmony export */   updateItem: () => (/* binding */ updateItem)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI;\nconst options = {\n    useUnifiedTopology: true,\n    useNewUrlParser: true\n};\nlet client;\nlet clientPromise;\nif (!process.env.MONGODB_URI) {\n    throw new Error(\"Please add your MongoDB URI to .env.local\");\n}\nif (true) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    if (!global._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n        global._mongoClientPromise = client.connect();\n    }\n    clientPromise = global._mongoClientPromise;\n} else {}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n// Helper functions for database operations\nasync function getItemsCollection() {\n    const client = await clientPromise;\n    const db = client.db(process.env.MONGODB_DB || \"p2p-marketplace\");\n    return db.collection(\"items\");\n}\nasync function getAllItems(query = {}) {\n    const collection = await getItemsCollection();\n    return collection.find(query).toArray();\n}\nasync function getItemById(id) {\n    const collection = await getItemsCollection();\n    return collection.findOne({\n        itemId: parseInt(id)\n    });\n}\nasync function createItem(item) {\n    const collection = await getItemsCollection();\n    return collection.insertOne(item);\n}\nasync function updateItem(id, updates) {\n    const collection = await getItemsCollection();\n    return collection.updateOne({\n        itemId: parseInt(id)\n    }, {\n        $set: updates\n    });\n}\nasync function deleteItem(id) {\n    const collection = await getItemsCollection();\n    return collection.deleteOne({\n        itemId: parseInt(id)\n    });\n}\nasync function searchItems(query) {\n    const collection = await getItemsCollection();\n    return collection.find({\n        name: {\n            $regex: query,\n            $options: \"i\"\n        }\n    }).toArray();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi91dGlscy9tb25nb2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBc0M7QUFFdEMsTUFBTUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxXQUFXO0FBQ25DLE1BQU1DLFVBQVU7SUFDZEMsb0JBQW9CO0lBQ3BCQyxpQkFBaUI7QUFDbkI7QUFFQSxJQUFJQztBQUNKLElBQUlDO0FBRUosSUFBSSxDQUFDUCxRQUFRQyxHQUFHLENBQUNDLFdBQVcsRUFBRTtJQUM1QixNQUFNLElBQUlNLE1BQU07QUFDbEI7QUFFQSxJQUFJUixJQUF5QixFQUFlO0lBQzFDLCtEQUErRDtJQUMvRCw2RUFBNkU7SUFDN0UsSUFBSSxDQUFDUyxPQUFPQyxtQkFBbUIsRUFBRTtRQUMvQkosU0FBUyxJQUFJUixnREFBV0EsQ0FBQ0MsS0FBS0k7UUFDOUJNLE9BQU9DLG1CQUFtQixHQUFHSixPQUFPSyxPQUFPO0lBQzdDO0lBQ0FKLGdCQUFnQkUsT0FBT0MsbUJBQW1CO0FBQzVDLE9BQU8sRUFJTjtBQUVELGlFQUFlSCxhQUFhQSxFQUFDO0FBRTdCLDJDQUEyQztBQUNwQyxlQUFlSztJQUNwQixNQUFNTixTQUFTLE1BQU1DO0lBQ3JCLE1BQU1NLEtBQUtQLE9BQU9PLEVBQUUsQ0FBQ2IsUUFBUUMsR0FBRyxDQUFDYSxVQUFVLElBQUk7SUFDL0MsT0FBT0QsR0FBR0UsVUFBVSxDQUFDO0FBQ3ZCO0FBRU8sZUFBZUMsWUFBWUMsUUFBUSxDQUFDLENBQUM7SUFDMUMsTUFBTUYsYUFBYSxNQUFNSDtJQUN6QixPQUFPRyxXQUFXRyxJQUFJLENBQUNELE9BQU9FLE9BQU87QUFDdkM7QUFFTyxlQUFlQyxZQUFZQyxFQUFFO0lBQ2xDLE1BQU1OLGFBQWEsTUFBTUg7SUFDekIsT0FBT0csV0FBV08sT0FBTyxDQUFDO1FBQUVDLFFBQVFDLFNBQVNIO0lBQUk7QUFDbkQ7QUFFTyxlQUFlSSxXQUFXQyxJQUFJO0lBQ25DLE1BQU1YLGFBQWEsTUFBTUg7SUFDekIsT0FBT0csV0FBV1ksU0FBUyxDQUFDRDtBQUM5QjtBQUVPLGVBQWVFLFdBQVdQLEVBQUUsRUFBRVEsT0FBTztJQUMxQyxNQUFNZCxhQUFhLE1BQU1IO0lBQ3pCLE9BQU9HLFdBQVdlLFNBQVMsQ0FDekI7UUFBRVAsUUFBUUMsU0FBU0g7SUFBSSxHQUN2QjtRQUFFVSxNQUFNRjtJQUFRO0FBRXBCO0FBRU8sZUFBZUcsV0FBV1gsRUFBRTtJQUNqQyxNQUFNTixhQUFhLE1BQU1IO0lBQ3pCLE9BQU9HLFdBQVdrQixTQUFTLENBQUM7UUFBRVYsUUFBUUMsU0FBU0g7SUFBSTtBQUNyRDtBQUVPLGVBQWVhLFlBQVlqQixLQUFLO0lBQ3JDLE1BQU1GLGFBQWEsTUFBTUg7SUFDekIsT0FBT0csV0FBV0csSUFBSSxDQUFDO1FBQ3JCaUIsTUFBTTtZQUFFQyxRQUFRbkI7WUFBT29CLFVBQVU7UUFBSTtJQUN2QyxHQUFHbEIsT0FBTztBQUNaIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3J5cHRvLXAycC1tYXJrZXRwbGFjZS8uL3V0aWxzL21vbmdvZGIuanM/OGZkNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcbmNvbnN0IG9wdGlvbnMgPSB7XG4gIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSxcbiAgdXNlTmV3VXJsUGFyc2VyOiB0cnVlLFxufTtcblxubGV0IGNsaWVudDtcbmxldCBjbGllbnRQcm9taXNlO1xuXG5pZiAoIXByb2Nlc3MuZW52Lk1PTkdPREJfVVJJKSB7XG4gIHRocm93IG5ldyBFcnJvcignUGxlYXNlIGFkZCB5b3VyIE1vbmdvREIgVVJJIHRvIC5lbnYubG9jYWwnKTtcbn1cblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gIC8vIEluIGRldmVsb3BtZW50IG1vZGUsIHVzZSBhIGdsb2JhbCB2YXJpYWJsZSBzbyB0aGF0IHRoZSB2YWx1ZVxuICAvLyBpcyBwcmVzZXJ2ZWQgYWNyb3NzIG1vZHVsZSByZWxvYWRzIGNhdXNlZCBieSBITVIgKEhvdCBNb2R1bGUgUmVwbGFjZW1lbnQpLlxuICBpZiAoIWdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlKSB7XG4gICAgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwgb3B0aW9ucyk7XG4gICAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpO1xuICB9XG4gIGNsaWVudFByb21pc2UgPSBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZTtcbn0gZWxzZSB7XG4gIC8vIEluIHByb2R1Y3Rpb24gbW9kZSwgaXQncyBiZXN0IHRvIG5vdCB1c2UgYSBnbG9iYWwgdmFyaWFibGUuXG4gIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmksIG9wdGlvbnMpO1xuICBjbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xpZW50UHJvbWlzZTtcblxuLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgZGF0YWJhc2Ugb3BlcmF0aW9uc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEl0ZW1zQ29sbGVjdGlvbigpIHtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgY2xpZW50UHJvbWlzZTtcbiAgY29uc3QgZGIgPSBjbGllbnQuZGIocHJvY2Vzcy5lbnYuTU9OR09EQl9EQiB8fCAncDJwLW1hcmtldHBsYWNlJyk7XG4gIHJldHVybiBkYi5jb2xsZWN0aW9uKCdpdGVtcycpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsSXRlbXMocXVlcnkgPSB7fSkge1xuICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZ2V0SXRlbXNDb2xsZWN0aW9uKCk7XG4gIHJldHVybiBjb2xsZWN0aW9uLmZpbmQocXVlcnkpLnRvQXJyYXkoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEl0ZW1CeUlkKGlkKSB7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRJdGVtc0NvbGxlY3Rpb24oKTtcbiAgcmV0dXJuIGNvbGxlY3Rpb24uZmluZE9uZSh7IGl0ZW1JZDogcGFyc2VJbnQoaWQpIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlSXRlbShpdGVtKSB7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRJdGVtc0NvbGxlY3Rpb24oKTtcbiAgcmV0dXJuIGNvbGxlY3Rpb24uaW5zZXJ0T25lKGl0ZW0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlSXRlbShpZCwgdXBkYXRlcykge1xuICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZ2V0SXRlbXNDb2xsZWN0aW9uKCk7XG4gIHJldHVybiBjb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICB7IGl0ZW1JZDogcGFyc2VJbnQoaWQpIH0sXG4gICAgeyAkc2V0OiB1cGRhdGVzIH1cbiAgKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUl0ZW0oaWQpIHtcbiAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IGdldEl0ZW1zQ29sbGVjdGlvbigpO1xuICByZXR1cm4gY29sbGVjdGlvbi5kZWxldGVPbmUoeyBpdGVtSWQ6IHBhcnNlSW50KGlkKSB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaEl0ZW1zKHF1ZXJ5KSB7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRJdGVtc0NvbGxlY3Rpb24oKTtcbiAgcmV0dXJuIGNvbGxlY3Rpb24uZmluZCh7XG4gICAgbmFtZTogeyAkcmVnZXg6IHF1ZXJ5LCAkb3B0aW9uczogJ2knIH1cbiAgfSkudG9BcnJheSgpO1xufSJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIm9wdGlvbnMiLCJ1c2VVbmlmaWVkVG9wb2xvZ3kiLCJ1c2VOZXdVcmxQYXJzZXIiLCJjbGllbnQiLCJjbGllbnRQcm9taXNlIiwiRXJyb3IiLCJnbG9iYWwiLCJfbW9uZ29DbGllbnRQcm9taXNlIiwiY29ubmVjdCIsImdldEl0ZW1zQ29sbGVjdGlvbiIsImRiIiwiTU9OR09EQl9EQiIsImNvbGxlY3Rpb24iLCJnZXRBbGxJdGVtcyIsInF1ZXJ5IiwiZmluZCIsInRvQXJyYXkiLCJnZXRJdGVtQnlJZCIsImlkIiwiZmluZE9uZSIsIml0ZW1JZCIsInBhcnNlSW50IiwiY3JlYXRlSXRlbSIsIml0ZW0iLCJpbnNlcnRPbmUiLCJ1cGRhdGVJdGVtIiwidXBkYXRlcyIsInVwZGF0ZU9uZSIsIiRzZXQiLCJkZWxldGVJdGVtIiwiZGVsZXRlT25lIiwic2VhcmNoSXRlbXMiLCJuYW1lIiwiJHJlZ2V4IiwiJG9wdGlvbnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./utils/mongodb.js\n");

/***/ }),

/***/ "(api)/./contracts/P2PMarketplaceABI.json":
/*!******************************************!*\
  !*** ./contracts/P2PMarketplaceABI.json ***!
  \******************************************/
/***/ ((module) => {

module.exports = JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"itemId","type":"uint256"},{"indexed":false,"internalType":"address","name":"msgSender","type":"address"},{"indexed":false,"internalType":"address","name":"tradeSeller","type":"address"}],"name":"DebugSeller","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"itemId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"ItemDelivered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"seller","type":"address"},{"indexed":true,"internalType":"uint256","name":"itemId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"ItemListed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"itemId","type":"uint256"},{"indexed":true,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"ItemPurchased","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"itemId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newPrice","type":"uint256"}],"name":"ItemPriceUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"itemId","type":"uint256"},{"indexed":false,"internalType":"address","name":"seller","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"PaymentReleased","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Withdrawal","type":"event"},{"inputs":[{"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"claimPayment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"confirmDelivery","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"itemId","type":"uint256"},{"internalType":"uint128","name":"newPrice","type":"uint128"}],"name":"editItemPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"getTradeDetails","outputs":[{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"isDelivered","type":"bool"},{"internalType":"bool","name":"isCompleted","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint128","name":"price","type":"uint128"}],"name":"listItem","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"itemId","type":"uint256"}],"name":"purchaseItem","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"trades","outputs":[{"internalType":"address payable","name":"seller","type":"address"},{"internalType":"address payable","name":"buyer","type":"address"},{"internalType":"uint128","name":"price","type":"uint128"},{"internalType":"bool","name":"isDelivered","type":"bool"},{"internalType":"bool","name":"isCompleted","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}]');

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fitems%2Fuser&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Citems%5Cuser.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();